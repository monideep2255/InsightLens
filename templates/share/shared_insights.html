{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
            <i class="fas fa-share-alt me-3" style="font-size: 1.5rem;"></i>
            <div>
                <strong>Shared View</strong> - This is a shared view of document insights. 
                {% if shareable_link.expires_at %}
                    This link will expire on {{ shareable_link.expires_at.strftime('%Y-%m-%d') }}.
                {% endif %}
            </div>
        </div>
    
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
            <h2 class="mb-3 mb-md-0">
                <i class="fas fa-glasses text-info me-2"></i>
                <span class="text-truncate d-inline-block" style="max-width: 100%;">
                {% if document.title %}
                    {{ document.title }}
                {% elif document.filename %}
                    {{ document.filename }}
                {% else %}
                    {{ document.url }}
                {% endif %}
                </span>
            </h2>
        </div>

        <div id="insight-container">
            <!-- Business Summary -->
            {% if 'business_summary' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-info text-dark">
                                <i class="fas fa-building"></i>
                            </div>
                            <h5 class="card-title mb-0">Business Summary</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.business_summary|safe }}
                    </div>
                </div>
            {% endif %}

            <!-- Moat & Edge -->
            {% if 'moat' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-success text-dark">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h5 class="card-title mb-0">Competitive Moat</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.moat|safe }}
                    </div>
                </div>
            {% endif %}

            <!-- Financial Health -->
            {% if 'financial' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-primary text-dark">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5 class="card-title mb-0">Financial Health</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.financial|safe }}
                    </div>
                </div>
            {% endif %}

            <!-- Management Snapshot -->
            {% if 'management' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-warning text-dark">
                                <i class="fas fa-users"></i>
                            </div>
                            <h5 class="card-title mb-0">Management Analysis</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.management|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Red Flags Detection - Only shown if red_flags category exists -->
            {% if 'red_flags' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-danger text-dark">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h5 class="card-title mb-0">Red Flags</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.red_flags|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Buffett Analysis - Only shown if buffett_analysis category exists -->
            {% if 'buffett_analysis' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-warning text-dark">
                                <i class="fas fa-award"></i>
                            </div>
                            <h5 class="card-title mb-0">Buffett's Perspective</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.buffett_analysis|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Enhanced Moat Analysis - Phase 2.1 feature -->
            {% if 'moat_analysis' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-success text-dark">
                                <i class="fas fa-chess-rook"></i>
                            </div>
                            <h5 class="card-title mb-0">Enhanced Moat Analysis</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.moat_analysis|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Margin of Safety - Phase 2.1 feature -->
            {% if 'margin_of_safety' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-primary text-dark">
                                <i class="fas fa-life-ring"></i>
                            </div>
                            <h5 class="card-title mb-0">Margin of Safety</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.margin_of_safety|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Biotech Analysis - Only shown if biotech_analysis category exists -->
            {% if 'biotech_analysis' in insights %}
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-info text-dark">
                                <i class="fas fa-microscope"></i>
                            </div>
                            <h5 class="card-title mb-0">Biotech Analysis</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ insights.biotech_analysis|safe }}
                    </div>
                </div>
            {% endif %}

            <!-- Disclaimer -->
            <div class="disclaimer">
                <p><strong>Disclaimer:</strong> This is an AI-generated analysis for research purposes only. 
                It does not constitute investment advice. The information presented may not be accurate or complete. 
                Always perform your own due diligence before making investment decisions.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
