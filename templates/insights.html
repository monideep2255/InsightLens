{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
            <h2 class="mb-3 mb-md-0">
                <i class="fas fa-glasses text-info me-2"></i>
                <span class="text-truncate d-inline-block" style="max-width: 100%;">
                {% if document.title %}
                    {{ document.title }}
                {% elif document.filename %}
                    {{ document.filename }}
                {% else %}
                    {{ document.url }}
                {% endif %}
                </span>
            </h2>
            <a href="{{ url_for('document_routes.index') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>New Analysis
            </a>
        </div>

        <div id="insight-container" data-document-id="{{ document.id }}">
            {% if insights %}
                <!-- Business Summary -->
                {% set business_summary = insights|selectattr('category', 'equalto', 'business_summary')|first %}
                {% if business_summary %}
                    <div class="card insight-card mb-4">
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="card-icon bg-info text-dark">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h5 class="card-title mb-0">Business Summary</h5>
                            </div>
                        </div>
                        <div class="card-body">
                            {{ business_summary.content|safe }}
                        </div>
                    </div>
                {% endif %}

                <!-- Moat & Edge -->
                {% set moat = insights|selectattr('category', 'equalto', 'moat')|first %}
                {% if moat %}
                    <div class="card insight-card mb-4">
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="card-icon bg-success text-dark">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <h5 class="card-title mb-0">Competitive Moat</h5>
                            </div>
                        </div>
                        <div class="card-body">
                            {{ moat.content|safe }}
                        </div>
                    </div>
                {% endif %}

                <!-- Financial Health -->
                {% set financial = insights|selectattr('category', 'equalto', 'financial')|first %}
                {% if financial %}
                    <div class="card insight-card mb-4">
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="card-icon bg-primary text-dark">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h5 class="card-title mb-0">Financial Health</h5>
                            </div>
                        </div>
                        <div class="card-body">
                            {{ financial.content|safe }}
                        </div>
                    </div>
                {% endif %}

                <!-- Management Snapshot -->
                {% set management = insights|selectattr('category', 'equalto', 'management')|first %}
                {% if management %}
                    <div class="card insight-card mb-4">
                        <div class="card-header">
                            <div class="card-title-wrapper">
                                <div class="card-icon bg-warning text-dark">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h5 class="card-title mb-0">Management Analysis</h5>
                            </div>
                        </div>
                        <div class="card-body">
                            {{ management.content|safe }}
                        </div>
                    </div>
                {% endif %}

                <!-- Research Methods -->
                <div class="card insight-card mb-4">
                    <div class="card-header">
                        <div class="card-title-wrapper">
                            <div class="card-icon bg-secondary text-dark">
                                <i class="fas fa-search"></i>
                            </div>
                            <h5 class="card-title mb-0">Research Methods</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6>Ways to research companies with InsightLens:</h6>
                        <div class="row mt-3">
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 research-method-card">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <i class="fas fa-search-dollar text-info me-2"></i>
                                            SEC EDGAR Search
                                        </h5>
                                        <p class="card-text">Search directly for public company filings (10-K reports) through the SEC's database. Just enter a company name like "Apple" or "Tesla".</p>
                                        <p class="small"><strong>Best for:</strong> US public companies, comprehensive official financial data</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 research-method-card">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <i class="fas fa-bolt text-info me-2"></i>
                                            Quick 10-K Access
                                        </h5>
                                        <p class="card-text">Directly access and analyze the latest 10-K filings from the 'Magnificent 7' tech companies with one click.</p>
                                        <p class="small"><strong>Best for:</strong> Fast insights on major tech companies without manual searching</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 research-method-card">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <i class="fas fa-file-pdf text-info me-2"></i>
                                            PDF Upload
                                        </h5>
                                        <p class="card-text">Upload annual reports, investor presentations, or financial documents you've downloaded.</p>
                                        <p class="small"><strong>Best for:</strong> Detailed analysis of specific documents you already have</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Disclaimer -->
                <div class="disclaimer">
                    <p><strong>Disclaimer:</strong> This is an AI-generated analysis for research purposes only. 
                    It does not constitute investment advice. The information presented may not be accurate or complete. 
                    Always perform your own due diligence before making investment decisions.</p>
                </div>
            {% else %}
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <h3>Analysis in Progress</h3>
                            <p class="text-muted">The AI is currently analyzing your document. This process may take several minutes depending on document size.</p>
                        </div>
                        
                        <div class="spinner-container d-flex flex-column flex-sm-row align-items-center justify-content-center mb-4">
                            <div class="spinner-border text-info mb-3 mb-sm-0" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="ms-sm-3 text-center text-sm-start">
                                <h5 id="processing-status">Analyzing document...</h5>
                                <p class="text-muted">Processing may take a few minutes</p>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center">
                            <button id="cancel-processing" class="btn btn-danger me-2">
                                <i class="fas fa-stop-circle me-2"></i>Cancel Processing
                            </button>
                            <a href="{{ url_for('document_routes.index') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-home me-2"></i>Return to Home
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
